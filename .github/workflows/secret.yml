name: Call API Example

on:
  workflow_dispatch:
    inputs:
      project_id:
        required: true
        type: string
        description: Please input GCP Project ID
      servicekey:
        required: true
        type: string
        description: GCP service accout key file

jobs:
  do_the_thing:
    runs-on: ubuntu-latest
    steps:
    - name: Mask Password
      run: |
        SA_KEY=$(jq -r '.inputs.servicekey' $GITHUB_EVENT_PATH)
        echo ::add-mask::$SA_KEY
        echo SA_KEY=$SA_KEY >> $GITHUB_ENV
    - name: Call API
      env:
        project_id: ${{ inputs.project_id }}
        service-json-key: ${{ inputs.servicekey }}
      run: |
        echo "$project_id"
        echo "$service-json-key"
  gcloud-auth:
    runs-on: ubuntu-latest
    # Add "id-token" with the intended permissions.
    permissions:
      contents: 'read'
      id-token: 'write'

    steps:
    - uses: 'actions/checkout@v4'

    - name: 'Set up Cloud SDK'
      uses: 'google-github-actions/auth@v2'
      with:
        credentials_json: '${{ inputs.servicekey }}'
        
    - name: 'Use gcloud CLI'
      run: 'gcloud info'
      
    - name: 'Use gcloud CLI'
      env:
        project_id: ${{ inputs.project_id }}
      run: |
       'gcloud beta resource-config bulk-export --project=$project_id --resource-types=ComputeDisk > vms.tf'
